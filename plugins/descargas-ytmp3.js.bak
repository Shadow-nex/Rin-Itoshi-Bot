/*import fetch from 'node-fetch'
import yts from 'yt-search'
import axios from 'axios'

let handler = async (m, { conn, text, command, usedPrefix }) => {
  try {
    if (!text) {
      return conn.reply(
        m.chat,
        `ğŸ‹ Ingresa el nombre de la canciÃ³n o un enlace de YouTube.\n\n> Ejemplo: ${usedPrefix + command} DJ Malam Pagi`,
        m
      )
    }

    await conn.sendMessage(m.chat, {
      react: { text: "â³", key: m.key }
    })

    let search = await yts(text)
    let video = search.videos[0]
    if (!video) return conn.reply(m.chat, 'â˜ï¸ No se encontrÃ³ ningÃºn resultado.', m)

    const apis = [
      { 
        api: 'ZenzzXD v2', 
        endpoint: `https://api.zenzxz.my.id/downloader/ytmp3v2?url=${encodeURIComponent(video.url)}`, 
        extractor: res => res.download_url 
      },
      { 
        api: 'Vreden', 
        endpoint: `https://api.vreden.my.id/api/v1/download/youtube/audio?url=${encodeURIComponent(video.url)}&quality=128`, 
        extractor: res => res.result?.download?.url 
      },
      { 
        api: 'Xyro', 
        endpoint: `https://xyro.site/download/youtubemp3?url=${encodeURIComponent(video.url)}`, 
        extractor: res => res.result?.dl 
      }
    ]

    const { url: downloadUrl, servidor } = await fetchFromApis(apis)

    if (!downloadUrl) {
      return conn.reply(m.chat, 'Ninguna API devolviÃ³ el audio.', m)
    }

    const size = await getSize(downloadUrl)
    const sizeStr = size ? formatSize(size) : 'Desconocido'

    const meta = {
      title: video.title,
      duration: video.timestamp,
      url: video.url,
      author: video.author?.name || "Desconocido",
      views: video.views?.toLocaleString('es-PE') || "0",
      ago: video.ago || "Desconocido",
      thumbnail: video.thumbnail,
      size: sizeStr,
      servidor
    }

    const textoInfo = `ğŸ¶ *ï¼¹ï¼¯ï¼µï¼´ï¼µï¼¢ï¼¥ â€¢ ï¼­ï¼°3* â˜ï¸
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
> Â°ğ“ƒ‰ğ‡½Ü³ğ“¸ğŸ‹á®¬á©¬Ö¼áª²ã€«Ö´ÛŸ. ğ“ğˆğ“ğ”ğ‹ğ: *${meta.title}*
> Â°ğ“ƒ‰ğ‡½Ü³ğ“¸ğŸŒ¿á®¬á©¬Ö¼áª²ã€«Ö´ÛŸ. ğƒğ”ğ‘ğ€ğ‚ğˆğğ: *${meta.duration}*
> Â°ğ“ƒ‰ğ‡½Ü³ğ“¸ğŸá®¬á©¬Ö¼áª²ã€«Ö´ÛŸ. ğ‚ğ€ğğ€ğ‹: *${meta.author}*
> Â°ğ“ƒ‰ğ‡½Ü³ğ“¸ğŸ„á®¬á©¬Ö¼áª²ã€«Ö´ÛŸ. ğ•ğˆğ’ğ“ğ€ğ’: *${meta.views}*
> Â°ğ“ƒ‰ğ‡½Ü³ğ“¸âš½á®¬á©¬Ö¼áª²ã€«Ö´ÛŸ. ğ“ğ€ğŒğ€ğÌƒğ: *${meta.size}*
> Â°ğ“ƒ‰ğ‡½Ü³ğ“¸â˜ï¸á®¬á©¬Ö¼áª²ã€«Ö´ÛŸ. ğ‚ğ€ğ‹ğˆğƒğ€ğƒ: *128kbps*
> Â°ğ“ƒ‰ğ‡½Ü³ğ“¸ğŸŒ·á®¬á©¬Ö¼áª²ã€«Ö´ÛŸ. ğğ”ğğˆğ‚ğ€ğƒğ: *${meta.ago}*
> Â°ğ“ƒ‰ğ‡½Ü³ğ“¸ğŸ•¸ï¸á®¬á©¬Ö¼áª²ã€«Ö´ÛŸ. ğ‹ğˆğğŠ: *${meta.url}*
> Â°ğ“ƒ‰ğ‡½Ü³ğ“¸âš™ï¸á®¬á©¬Ö¼áª²ã€«Ö´ÛŸ. ğ’ğ„ğ‘ğ•ğˆğƒğğ‘: *${meta.servidor}*
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

> *â‰¡ Enviando, espera un momento...*`

    const rcanal = async () => {
      return {
        contextInfo: {
          isForwarded: true,
          forwardedNewsletterMessageInfo: {
            newsletterJid: '120363401008003732@newsletter',
            serverMessageId: '',
            newsletterName: 'å›¹ğŸ‹ğ‘œ áª²â€¢Ë™ê¨‚ Ö¢âœ§: ÑÎ¹Ğ¸ Î¹Ñ‚ÏƒÑ•Ğ½Î¹ - Â¢Ğ½Î±Ğ¸Ğ¸Ñ”â„“ ÏƒffÎ¹Â¢Î¹Î±â„“ à©ˆâ™¡â€§â‚ŠËš'
          },
          externalAdReply: {
            title: "ğ”Œ . â‹® ğ—• ğ—¨ ğ—¦ ğ—– ğ—” ğ—¡ ğ—— ğ—¢ .áŸ Ö¹ â‚Š ê’±",
            body: "Buscando en Youtube...",
            mediaUrl: null,
            description: null,
            previewType: "PHOTO",
            thumbnail: await (await fetch('https://i.pinimg.com/originals/e0/98/ba/e098bac73c8ae72243f66c7bf712045a.jpg')).buffer(),
            sourceUrl: redes,
            mediaType: 1,
            renderLargerThumbnail: false
          }
        }
      }
    }

    await conn.sendMessage(m.chat, {
      image: { url: meta.thumbnail },
      caption: textoInfo,
      ...(await rcanal())
    }, { quoted: m })

    const audioBuffer = await (await fetch(downloadUrl)).buffer()
    await conn.sendMessage(m.chat, {
      audio: audioBuffer,
      fileName: `${meta.title}.mp3`,
      mimetype: "audio/mpeg",
      ptt: false,
      contextInfo: {
        externalAdReply: {
          title: meta.title,
          body: `DuraciÃ³n: ${meta.duration} min | Calidad: 128kbps | Peso: ${meta.size}`,
          mediaUrl: meta.url,
          sourceUrl: meta.url,
          thumbnailUrl: meta.thumbnail,
          mediaType: 1,
          renderLargerThumbnail: true
        }
      }
    }, { quoted: fkontak })

    await conn.sendMessage(m.chat, {
      react: { text: "âœ”ï¸", key: m.key }
    })

  } catch (e) {
    console.error(e)
    await conn.reply(m.chat, `âŒ Error: ${e.message}`, m)
  }
}

handler.command = ['ytmp3', 'song']
handler.tags = ['descargas']
handler.help = ['ytmp3 <texto o link>', 'song <texto>']
handler.group = true

export default handler

async function fetchFromApis(apis) {
  for (const api of apis) {
    try {
      const res = await fetch(api.endpoint)
      const json = await res.json()
      const url = api.extractor(json)
      if (url) return { url, servidor: api.api }
    } catch (e) { }
  }
  return { url: null, servidor: "Ninguno" }
}

async function getSize(url) {
  try {
    const response = await axios.head(url)
    const length = response.headers['content-length']
    return length ? parseInt(length, 10) : null
  } catch {
    return null
  }
}

function formatSize(bytes) {
  const units = ['B', 'KB', 'MB', 'GB']
  let i = 0
  if (!bytes || isNaN(bytes)) return 'Desconocido'
  while (bytes >= 1024 && i < units.length - 1) {
    bytes /= 1024
    i++
  }
  return `${bytes.toFixed(2)} ${units[i]}`
}
*/

import fetch from 'node-fetch'
import yts from 'yt-search'
import axios from 'axios'

let handler = async (m, { conn, text, command, usedPrefix }) => {
  try {
    if (!text) {
      return conn.reply(
        m.chat,
        `ğŸ‹ Ingresa el nombre de la canciÃ³n o un enlace de YouTube.\n\n> Ejemplo: ${usedPrefix + command} DJ Malam Pagi`,
        m
      )
    }

    await conn.sendMessage(m.chat, { react: { text: "â³", key: m.key } })

    let search = await yts(text)
    let video = search.videos[0]
    if (!video) return conn.reply(m.chat, 'â˜ï¸ No se encontrÃ³ ningÃºn resultado.', m)

    const apis = [
      { 
        api: 'ZenzzXD v2', 
        endpoint: `https://api.zenzxz.my.id/downloader/ytmp3v2?url=${encodeURIComponent(video.url)}`, 
        extractor: res => res.download_url 
      },
      { 
        api: 'Vreden', 
        endpoint: `https://api.vreden.my.id/api/v1/download/youtube/audio?url=${encodeURIComponent(video.url)}&quality=128`, 
        extractor: res => res.result?.download?.url 
      },
      { 
        api: 'Xyro', 
        endpoint: `https://xyro.site/download/youtubemp3?url=${encodeURIComponent(video.url)}`, 
        extractor: res => res.result?.dl 
      }
    ]

    const { url: downloadUrl, servidor } = await fetchFromApis(apis)
    if (!downloadUrl) return conn.reply(m.chat, 'âŒ Ninguna API devolviÃ³ el audio.', m)

    const size = await getSize(downloadUrl)
    const sizeStr = size ? formatSize(size) : 'Desconocido'

    const meta = {
      title: video.title,
      duration: video.timestamp,
      url: video.url,
      author: video.author?.name || "Desconocido",
      views: video.views?.toLocaleString('es-PE') || "0",
      ago: video.ago || "Desconocido",
      thumbnail: video.thumbnail,
      size: sizeStr,
      servidor
    }

    const textoInfo = `ğŸ¶ *ï¼¹ï¼¯ï¼µï¼´ï¼µï¼¢ï¼¥ â€¢ ï¼­ï¼°3* â˜ï¸
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
> Â°ğ“ƒ‰ğ‡½Ü³ğ“¸ğŸ‹á®¬á©¬Ö¼áª²ã€«Ö´ÛŸ. ğ“ğˆğ“ğ”ğ‹ğ: *${meta.title}*
> Â°ğ“ƒ‰ğ‡½Ü³ğ“¸ğŸŒ¿á®¬á©¬Ö¼áª²ã€«Ö´ÛŸ. ğƒğ”ğ‘ğ€ğ‚ğˆğğ: *${meta.duration}*
> Â°ğ“ƒ‰ğ‡½Ü³ğ“¸ğŸá®¬á©¬Ö¼áª²ã€«Ö´ÛŸ. ğ‚ğ€ğğ€ğ‹: *${meta.author}*
> Â°ğ“ƒ‰ğ‡½Ü³ğ“¸ğŸ„á®¬á©¬Ö¼áª²ã€«Ö´ÛŸ. ğ•ğˆğ’ğ“ğ€ğ’: *${meta.views}*
> Â°ğ“ƒ‰ğ‡½Ü³ğ“¸âš½á®¬á©¬Ö¼áª²ã€«Ö´ÛŸ. ğ“ğ€ğŒğ€ğÌƒğ: *${meta.size}*
> Â°ğ“ƒ‰ğ‡½Ü³ğ“¸â˜ï¸á®¬á©¬Ö¼áª²ã€«Ö´ÛŸ. ğ‚ğ€ğ‹ğˆğƒğ€ğƒ: *128kbps*
> Â°ğ“ƒ‰ğ‡½Ü³ğ“¸ğŸŒ·á®¬á©¬Ö¼áª²ã€«Ö´ÛŸ. ğğ”ğğˆğ‚ğ€ğƒğ: *${meta.ago}*
> Â°ğ“ƒ‰ğ‡½Ü³ğ“¸ğŸ•¸ï¸á®¬á©¬Ö¼áª²ã€«Ö´ÛŸ. ğ‹ğˆğğŠ: *${meta.url}*
> Â°ğ“ƒ‰ğ‡½Ü³ğ“¸âš™ï¸á®¬á©¬Ö¼áª²ã€«Ö´ÛŸ. ğ’ğ„ğ‘ğ•ğˆğƒğğ‘: *${meta.servidor}*
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

> *â‰¡ Enviando, espera un momento...*`

    const rcanal = async () => {
      return {
        contextInfo: {
          isForwarded: true,
          forwardedNewsletterMessageInfo: {
            newsletterJid: '120363401008003732@newsletter',
            serverMessageId: '',
            newsletterName: 'å›¹ğŸ‹ğ‘œ áª²â€¢Ë™ê¨‚ Ö¢âœ§: ÑÎ¹Ğ¸ Î¹Ñ‚ÏƒÑ•Ğ½Î¹ - Â¢Ğ½Î±Ğ¸Ğ¸Ñ”â„“ ÏƒffÎ¹Â¢Î¹Î±â„“ à©ˆâ™¡â€§â‚ŠËš'
          },
          externalAdReply: {
            title: "ğ”Œ . â‹® ğ—• ğ—¨ ğ—¦ ğ—– ğ—” ğ—¡ ğ—— ğ—¢ .áŸ Ö¹ â‚Š ê’±",
            body: "Buscando en Youtube...",
            mediaUrl: null,
            description: null,
            previewType: "PHOTO",
            thumbnail: await (await fetch('https://i.pinimg.com/originals/e0/98/ba/e098bac73c8ae72243f66c7bf712045a.jpg')).buffer(),
            sourceUrl: redes,
            mediaType: 1,
            renderLargerThumbnail: false
          }
        }
      }
    }

    await conn.sendMessage(m.chat, {
      image: { url: meta.thumbnail },
      caption: textoInfo,
      ...(await rcanal())
    }, { quoted: m })

    const audioBuffer = await (await fetch(downloadUrl)).buffer()
    await conn.sendMessage(m.chat, {
      audio: audioBuffer,
      fileName: `${meta.title}.mp3`,
      mimetype: "audio/mpeg",
      ptt: false,
      contextInfo: {
        externalAdReply: {
          showAdAttribution: true,
          title: 'ğ˜ ğ ğ” ğ“ ğ” ğ ğ„ â€¢ ğŒ ğ” ğ’ ğˆ ğ‚',
          body: `DuraciÃ³n: ${meta.duration} min | Calidad: 128kbps | Peso: ${meta.size}`,
          thumbnailUrl: meta.thumbnail,
          mediaType: 2,
          renderLargerThumbnail: true,
          mediaUrl: meta.url,
          sourceUrl: meta.url
        }
      }
    }, { quoted: m })

    await conn.sendMessage(m.chat, { react: { text: "âœ”ï¸", key: m.key } })

  } catch (e) {
    console.error(e)
    await conn.reply(m.chat, `âŒ Error: ${e.message}`, m)
  }
}

handler.command = ['ytmp3', 'song']
handler.tags = ['descargas']
handler.help = ['ytmp3 <texto o link>', 'song <texto>']
handler.group = true
handler.register = true

export default handler

async function fetchFromApis(apis) {
  for (const api of apis) {
    try {
      const res = await fetch(api.endpoint)
      const json = await res.json()
      const url = api.extractor(json)
      if (url) return { url, servidor: api.api }
    } catch {}
  }
  return { url: null, servidor: "Ninguno" }
}

async function getSize(url) {
  try {
    const response = await axios.head(url)
    const length = response.headers['content-length']
    return length ? parseInt(length, 10) : null
  } catch {
    return null
  }
}

function formatSize(bytes) {
  const units = ['B', 'KB', 'MB', 'GB']
  let i = 0
  if (!bytes || isNaN(bytes)) return 'Desconocido'
  while (bytes >= 1024 && i < units.length - 1) {
    bytes /= 1024
    i++
  }
  return `${bytes.toFixed(2)} ${units[i]}`
}



mani cambia la api 3

https://api.yupra.my.id/api/downloader/ytmp3?url=https%3A%2F%2Fyoutube.com%2Fwatch%3Fv%3DnlXqp3FVrq8


domas defines las keys q descarga el audio 

{
  "status": 200,
  "result": {
    "link": "https://nu.123tokyo.xyz/get.php/a/90/nlXqp3FVrq8.mp3?n=Dalex%20-%20Hola%20Remix%20ft.%20Lenny%20Tav%C3%A1rez%2C%20Chencho%20Corleone%2C%20Juhn%20_El%20All%20Star_%20%28Video%20L%C3%ADrico%20Oficial%29&uT=R&uN=ZHVieWE%3D&h=DtxunwHm-6tugDnqifLGRA&s=1760533584&uT=R&uN=ZHVieWE%3D",
    "title": "Dalex - Hola Remix ft. Lenny TavÃ¡rez, Chencho Corleone, Juhn \"El All Star\" (Video LÃ­rico Oficial)",
    "filesize": 3804110,
    "progress": 100,
    "duration": 251.611,
    "status": "ok",
    "msg": "success"
  },
  "creator": "YP"
}

xd

la api 2 ahi dejala xd

aÃ±ade esta 

https://api.stellarwa.xyz/dow/ytmp3?url=https://youtu.be/Q1Hta4K6qVM&apikey=Shadow_Core

descripciÃ³n 

{"status":true,"creator":"I'm Zyxl","data":{"title":"sma$her - DANCÌ§A DO VERAÌƒO","author":"Phonky Town","dl":"https://cdn.stellarwa.xyz/files/M8Zi.mp3"}}


la api uno si actualizala pq la actulza a la api

curl -X GET "https://api.zenzxz.my.id/api/downloader/ytmp3v2?url=https%3A%2F%2Fyoutube.com%2Fwatch%3Fv%3DnlXqp3FVrq8"



las keys
{
  "statusCode": 200,
  "success": true,
  "creator": "ZenzzXD",
  "data": {
    "title": "Dalex - Hola Remix ft. Lenny TavÃ¡rez, Chencho Corleone, Juhn \"El All Star\" (Video LÃ­rico Oficial)",
    "duration": 252,
    "thumbnail": "https://i.ytimg.com/vi_webp/nlXqp3FVrq8/maxresdefault.webp",
    "type": "audio",
    "format": "mp3",
    "download_url": "https://cdn401.savetube.su/media/nlXqp3FVrq8/dalex-hola-remix-ft-lenny-tavarez-chencho-corleone-juhn-el-all-star-video-lirico-oficial-128-ytshorts.savetube.me.mp3"
  },
  "timestamp": "2025-10-15T11:09:58.954Z"
}



de las apis domas defines las keys q fescargan el audio jeje donde envia el audio no lo muevas y cambai de puesto textoInfo
ponko al principio de las apis depues van las apis para q asi se envia mas rapido el audio y el tetxo tambiÃ©n ya q estamos usando yt-search 