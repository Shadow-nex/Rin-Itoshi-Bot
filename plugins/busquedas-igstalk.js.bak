/*import fetch from 'node-fetch';

let handler = async (m, { conn, text, usedPrefix, command }) => {
  if (!text) {
    return conn.reply(m.chat, `*ğŸ” Ingrese el nombre de usuario de Instagram.*\n\nEjemplo:\n> *${usedPrefix + command}* xrljose`, m, rcanal);
  }

  await m.react('ğŸ•“');
  try {
    const res = await fetch(`https://delirius-apiofc.vercel.app/tools/igstalk?username=${text}`);
    const json = await res.json();

    if (!json.data) {
      await m.react('âœ–ï¸');
      return await conn.reply(m.chat, 'No se encontraron resultados para esta bÃºsqueda.', m);
    }

    const { username, full_name: fullName, followers, following, posts, profile_picture: profilePic, verified } = json.data;

    let txt = '`ä¹‚  I N S T A G R A M  -  S T A L K`\n\n';
    txt += `  âœ©   *Usuario* : ${username}\n`;
    txt += `  âœ©   *Nombre completo* : ${fullName}\n`;
    txt += `  âœ©   *Seguidores* : ${followers}\n`;
    txt += `  âœ©   *Siguiendo* : ${following}\n`;
    txt += `  âœ©   *Publicaciones* : ${posts}\n`;
    txt += `  âœ©   *Verificado* : ${verified ? 'SÃ­' : 'No'}\n`;
    txt += `  âœ©   *Perfil* : https://instagram.com/${username}\n`;

    await conn.sendFile(m.chat, profilePic, 'thumbnail.jpg', txt, m, rcanal);
    await m.react('âœ…');
  } catch (error) {
    console.error(error);
    await m.react('âœ–ï¸');
    await conn.reply(m.chat, 'Hubo un error al procesar la solicitud. Intenta de nuevo mÃ¡s tarde.', m);
  }
};

handler.help = ['instagramstalk <usuario>'];
handler.tags = ['tools'];
handler.command = ['instagramstalk', 'stalkinstagram', 'igstalk'];
handler.register = true;

export default handler;*/


// plugins/ig.js
import fetch from "node-fetch"

let handler = async (m, { conn, text, usedPrefix, command }) => {
  if (!text) {
    return m.reply(`âš ï¸ Uso correcto:\n${usedPrefix + command} usuario_de_instagram\n\nEjemplo:\n${usedPrefix + command} naruto`)
  }

  try {
    const username = text.replace(/^@/, "").trim()

    const url = `https://i.instagram.com/api/v1/users/web_profile_info/?username=${encodeURIComponent(username)}`
    const headers = {
      "User-Agent": "Mozilla/5.0 (Linux; Android 10; Mobile; rv:109.0) Gecko/115.0 Firefox/115.0",
      "x-ig-app-id": "936619743392459"
    }

    const res = await fetch(url, { headers })
    if (!res.ok) {
      throw new Error(`HTTP ${res.status}`)
    }
    const json = await res.json()

    const user = json.data?.user
    if (!user) {
      return m.reply(`âŒ No encontrÃ© el perfil de *${username}* o es privado.`)
    }

    let { username: uname, full_name, biography, edge_followed_by, edge_follow, is_private, profile_pic_url_hd } = user

    let info = `ğŸŒ¸ *Perfil de Instagram* ğŸŒ¸

âš”ï¸ Shinobi: @${uname}
ğŸ“› Nombre: ${full_name || "-"}
ğŸ”’ Privado: ${is_private ? "SÃ­" : "No"}
ğŸ‘¥ Seguidores: ${edge_followed_by?.count || 0}
â¡ï¸ Siguiendo: ${edge_follow?.count || 0}
ğŸ“ Bio: ${biography || "-"}
ğŸ“ Link: https://instagram.com/${uname}`

    await conn.sendFile(m.chat, profile_pic_url_hd, "profile.jpg", info, m)

  } catch (e) {
    console.error("Error en plugin ig:", e)
    m.reply("ğŸ’” No se pudo obtener el perfil, puede ser privado o Instagram cambiÃ³ algo. Intenta con otro usuario.")
  }
}

handler.help = ["instagramstalk <usuario>"]
handler.tags = ["tools"]
handler.command = /^instagramstalk$/i

export default handler