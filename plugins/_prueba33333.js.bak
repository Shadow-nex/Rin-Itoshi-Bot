import os from 'os'
import { performance } from 'perf_hooks'

let handler = async (m, { conn, usedPrefix }) => {
  
  // 📸 Lista de imágenes aleatorias
  const imgs = [
    "https://i.postimg.cc/NGrhjVTv/IMG-20250909-WA0062.jpg",
    "https://i.postimg.cc/vmBCmj8y/IMG-20250910-WA0015.jpg",
    "https://i.postimg.cc/ZnqM1fZq/IMG-20250911-WA0028.jpg",
    "https://i.postimg.cc/8zkV6Wyw/IMG-20250912-WA0044.jpg"
  ]
  let randomImg = imgs[Math.floor(Math.random() * imgs.length)]

  // 🕒 Fecha y hora
  let fecha = new Date()
  let fechaStr = fecha.toLocaleDateString('es-PE', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })
  let hora = fecha.toLocaleTimeString('es-PE', { hour: '2-digit', minute: '2-digit', second: '2-digit' })

  // ⏳ Uptime del bot
  let uptimeMs = performance.now()
  let uptimeSeg = Math.floor(process.uptime())
  let uptimeStr = convertirTiempo(uptimeSeg)

  // 🖥️ RAM info
  let memoriaTotal = os.totalmem() / 1024 / 1024
  let memoriaLibre = os.freemem() / 1024 / 1024
  let memoriaUsada = memoriaTotal - memoriaLibre

  // ⚙️ Plugins/comandos
  let totalPlugins = Object.keys(conn?.plugins || {}).length

  // 📝 Menú
  let menuTexto = `
╭━━━〔 ⚽ *MAGNOSBOT MENU* ⚽ 〕━━⬣
┃ 📅 *Fecha:* ${fechaStr}
┃ 🕒 *Hora:* ${hora}
┃ ⏳ *Tiempo activo:* ${uptimeStr}
┃ 🖥️ *RAM usada:* ${memoriaUsada.toFixed(2)} MB
┃ 🖥️ *RAM libre:* ${memoriaLibre.toFixed(2)} MB
┃ ⚙️ *Comandos:* ${totalPlugins}
┃
┃ 💡 *Funciones Principales*
┃ ✦ ${usedPrefix}play <canción>
┃ ✦ ${usedPrefix}ytmp3 <url>
┃ ✦ ${usedPrefix}ytmp4 <url>
┃ ✦ ${usedPrefix}soundcloud <url>
┃ ✦ ${usedPrefix}tiktok <url>
┃ ✦ ${usedPrefix}fb <url>
┃ ✦ ${usedPrefix}ig <url>
┃ ✦ ${usedPrefix}apk <nombre>
┃ ✦ ${usedPrefix}sticker
┃ ✦ ${usedPrefix}toimg
┃ ✦ ${usedPrefix}ai <texto>
┃ ✦ ${usedPrefix}verify
┃
┃ 🎮 *Juegos y Diversión*
┃ ✦ ${usedPrefix}love @tag
┃ ✦ ${usedPrefix}ppt
┃ ✦ ${usedPrefix}slots
┃ ✦ ${usedPrefix}adivina
┃ ✦ ${usedPrefix}casino
┃
┃ 👑 *Owner*
┃ ✦ ${usedPrefix}restart
┃ ✦ ${usedPrefix}deletesesion
┃ ✦ ${usedPrefix}ban @tag
┃ ✦ ${usedPrefix}unban @tag
┃
╰━━━━━━━━━━━━━━━━━━⬣
`

  await conn.sendMessage(m.chat, {
    text: menuTexto,
    contextInfo: {
      forwardingScore: 999,
      isForwarded: true,
      forwardedNewsletterMessageInfo: { 
        newsletterName: 'MagnosBot | CHANNEL', 
        newsletterJid: "120363422169517881@newsletter" 
      },
      externalAdReply: {
        title: `© MagnosBot`,
        body: 'Multipropósito - IA, Descargas, Juegos y más',
        thumbnailUrl: randomImg,
        sourceUrl: 'https://github.com/OmarGranda',
        mediaType: 1,
        renderLargerThumbnail: true
      }
    }
  }, { quoted: fkontak })
}

// Función para convertir segundos a formato hh:mm:ss
function convertirTiempo(segundos) {
  let horas = Math.floor(segundos / 3600)
  let minutos = Math.floor((segundos % 3600) / 60)
  let seg = segundos % 60
  return [horas, minutos, seg]
    .map(v => v.toString().padStart(2, '0'))
    .join(':')
}

handler.command = ['inicio']
export default handler