import os from 'os'
import { performance } from 'perf_hooks'

let handler = async (m, { conn, usedPrefix }) => {
  
  // ğŸ“¸ Lista de imÃ¡genes aleatorias
  const imgs = [
    "https://i.postimg.cc/NGrhjVTv/IMG-20250909-WA0062.jpg",
    "https://i.postimg.cc/vmBCmj8y/IMG-20250910-WA0015.jpg",
    "https://i.postimg.cc/ZnqM1fZq/IMG-20250911-WA0028.jpg",
    "https://i.postimg.cc/8zkV6Wyw/IMG-20250912-WA0044.jpg"
  ]
  let randomImg = imgs[Math.floor(Math.random() * imgs.length)]

  // ğŸ•’ Fecha y hora
  let fecha = new Date()
  let fechaStr = fecha.toLocaleDateString('es-PE', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })
  let hora = fecha.toLocaleTimeString('es-PE', { hour: '2-digit', minute: '2-digit', second: '2-digit' })

  // â³ Uptime del bot
  let uptimeMs = performance.now()
  let uptimeSeg = Math.floor(process.uptime())
  let uptimeStr = convertirTiempo(uptimeSeg)

  // ğŸ–¥ï¸ RAM info
  let memoriaTotal = os.totalmem() / 1024 / 1024
  let memoriaLibre = os.freemem() / 1024 / 1024
  let memoriaUsada = memoriaTotal - memoriaLibre

  // âš™ï¸ Plugins/comandos
  let totalPlugins = Object.keys(conn?.plugins || {}).length

  // ğŸ“ MenÃº
  let menuTexto = `
â•­â”â”â”ã€” âš½ *MAGNOSBOT MENU* âš½ ã€•â”â”â¬£
â”ƒ ğŸ“… *Fecha:* ${fechaStr}
â”ƒ ğŸ•’ *Hora:* ${hora}
â”ƒ â³ *Tiempo activo:* ${uptimeStr}
â”ƒ ğŸ–¥ï¸ *RAM usada:* ${memoriaUsada.toFixed(2)} MB
â”ƒ ğŸ–¥ï¸ *RAM libre:* ${memoriaLibre.toFixed(2)} MB
â”ƒ âš™ï¸ *Comandos:* ${totalPlugins}
â”ƒ
â”ƒ ğŸ’¡ *Funciones Principales*
â”ƒ âœ¦ ${usedPrefix}play <canciÃ³n>
â”ƒ âœ¦ ${usedPrefix}ytmp3 <url>
â”ƒ âœ¦ ${usedPrefix}ytmp4 <url>
â”ƒ âœ¦ ${usedPrefix}soundcloud <url>
â”ƒ âœ¦ ${usedPrefix}tiktok <url>
â”ƒ âœ¦ ${usedPrefix}fb <url>
â”ƒ âœ¦ ${usedPrefix}ig <url>
â”ƒ âœ¦ ${usedPrefix}apk <nombre>
â”ƒ âœ¦ ${usedPrefix}sticker
â”ƒ âœ¦ ${usedPrefix}toimg
â”ƒ âœ¦ ${usedPrefix}ai <texto>
â”ƒ âœ¦ ${usedPrefix}verify
â”ƒ
â”ƒ ğŸ® *Juegos y DiversiÃ³n*
â”ƒ âœ¦ ${usedPrefix}love @tag
â”ƒ âœ¦ ${usedPrefix}ppt
â”ƒ âœ¦ ${usedPrefix}slots
â”ƒ âœ¦ ${usedPrefix}adivina
â”ƒ âœ¦ ${usedPrefix}casino
â”ƒ
â”ƒ ğŸ‘‘ *Owner*
â”ƒ âœ¦ ${usedPrefix}restart
â”ƒ âœ¦ ${usedPrefix}deletesesion
â”ƒ âœ¦ ${usedPrefix}ban @tag
â”ƒ âœ¦ ${usedPrefix}unban @tag
â”ƒ
â•°â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â¬£
`

  await conn.sendMessage(m.chat, {
    text: menuTexto,
    contextInfo: {
      forwardingScore: 999,
      isForwarded: true,
      forwardedNewsletterMessageInfo: { 
        newsletterName: 'MagnosBot | CHANNEL', 
        newsletterJid: "120363422169517881@newsletter" 
      },
      externalAdReply: {
        title: `Â© MagnosBot`,
        body: 'MultipropÃ³sito - IA, Descargas, Juegos y mÃ¡s',
        thumbnailUrl: randomImg,
        sourceUrl: 'https://github.com/OmarGranda',
        mediaType: 1,
        renderLargerThumbnail: true
      }
    }
  }, { quoted: fkontak })
}

// FunciÃ³n para convertir segundos a formato hh:mm:ss
function convertirTiempo(segundos) {
  let horas = Math.floor(segundos / 3600)
  let minutos = Math.floor((segundos % 3600) / 60)
  let seg = segundos % 60
  return [horas, minutos, seg]
    .map(v => v.toString().padStart(2, '0'))
    .join(':')
}

handler.command = ['inicio']
export default handler